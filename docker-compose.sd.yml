version: '3.8'

services:
  stable-diffusion:
    image: universonic/stable-diffusion-webui:latest
    container_name: sd-webui
    ports:
      - "7860:7860"
    volumes:
      # Models storage (will persist between restarts)
      - ./sd-data/models:/app/stable-diffusion-webui/models/Stable-diffusion
      # Outputs storage
      - ./sd-data/outputs:/app/stable-diffusion-webui/outputs
      # Extensions storage  
      - ./sd-data/extensions:/app/stable-diffusion-webui/extensions
      # Config storage
      - ./sd-data/config:/app/stable-diffusion-webui/config
    environment:
      # Enable API access
      - CLI_ARGS=--api --listen --port 7860 --allow-code --medvram --opt-split-attention
      # Gradio settings
      - GRADIO_SERVER_NAME=0.0.0.0
      - GRADIO_SERVER_PORT=7860
    restart: unless-stopped
    # Uncomment the following lines if you have NVIDIA GPU
    # deploy:
    #   resources:
    #     reservations:
    #       devices:
    #         - driver: nvidia
    #           count: 1
    #           capabilities: [gpu]